---
date: 2024-03-10 00:00:00
layout: post
title: Spring 싱글톤
subtitle: Spring 싱글톤
description: Spring 싱글톤
image: /assets/img/ss.png
optimized_image: /assets/img/ss.png
category: spring
tags:
  - study
  - spring
author: byeongjunjang
paginate: true
---

# 싱글톤

> 싱글톤 패턴은 GoF가 소개한 디자인 패턴 중 하나로, 어플리케이션 내에 하나의 인스턴스가 존재하도록 강제하는 패턴이다.  
이렇게 만들어진 클래스의 오브젝트는 애플리케이션 내에 전역적으로 접근이 가능하다.

싱글톤 패턴을 사용할 때 상태를 가진 객체를 싱글톤으로 만들면 안된다.  
**즉, 무상태로 작업해야한다.**

## 쓰임?

**오브젝트가 단일로 존재하고 여러 곳에 공유하는 경우** 주로 사용된다.  

*ex)controller, service*

#### 어떻게 사용할까

- 해당 클래스를 밖에서 생성하지 못하도록 **기본 생성자를 private** 으로 만듦
- 자신과 같은 타입의 static 필드를 정의
- 최초로 호출되는 시점에서 한 번만 오브젝트가 만들어지게 함

## 안티패턴?

> 싱글톤을 사용하면 대부분 인터페이스가 아닌 콘크리트 클래스의 객체를 미리 생성해놓고 정적 메소드를 이용해 사용하게 된다. 
이는 여러 solid 원칙을 위반할 수 있는 가능성을 열어두고 싱글톤 클래스 사이에 의존성이 생긴다.
즉 높은 결합이 생기게 되면 수정, 단위테스트의 어려움 등 다양한 문제가 발생한다.

#### 단점

1. 객체지향과 맞지 않음
2. 테스트하기 어려움
3. 서버 환경에선 하나만 만들어지는 것을 보장 못함

## 스프링 빈

빈은 스프링 프레임워크에서 사용되는 키워드이다.

> bean은 스프링이 IoC 방식으로 관리하는 오브젝트이다.  
스프링이 직접 생성과 제어를 담당하는 오브젝트만을 빈이라 부른다.

### 왜 빈은 기본 스코프가 싱글톤?

> 스프링은 대부분 서버 환경에서 사용되고 매번 클라이언트에 요청이 들어올 때마다 각 로직을 담당하는 오브젝트들을 새로 생성하기 어렵다.
따라서, 클래스당 하나의 오브젝트만 만들어주고 사용자의 요청을 담당하는 여러 스레드에서 하나의 오브젝트를 공유해 동시에 사용한다.

싱글톤이란 것은 디자인 패턴에서 나오는 싱글톤 패턴과 비슷한 개념이지만 구현 방법은 다름.  
위의 단점이 있기에 **Spring은 Singleton registry**를 이용해 싱글톤을 구현한다.

## Singleton registry

스프링이 직접  싱글턴 객체를 만들고 관리하는 기능을 제공하는 것을 의미한다.  
이 구현 방법은 static 메서드와 private 생성자를 이용하여 single object로 생성됨을 강제하지 않는다.  
단지, 평범한 java class를 singleton으로 활용하게 해준다.  
이 말인 즉슨, 평범한 public 생성자를 가진 자바 클래스를 싱글턴으로 활용할 수 있게 만들어준다.  
그렇게 할 수 있는 이유는  클래스의 제어권을 IoC방식의 컨테이너에게 넘기면 해당 컨테이너가 객체 생성에 대한 모든 권한을 가질 수 있기 때문이다.  
따라서 객체가 싱글턴으로 존재할 수 있게 관리할 수 있다.  
IoC 컨테이너의 제어 역할을 통해서 빈을 싱글톤으로 만들 수 있는 것이다.